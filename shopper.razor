clearignore

#Populate container lists
removelist 'container_graphic_ids'
createlist 'container_graphic_ids'
pushlist 'container_graphic_ids' 2448
pushlist 'container_graphic_ids' 2472
pushlist 'container_graphic_ids' 2473
pushlist 'container_graphic_ids' 2474
pushlist 'container_graphic_ids' 2475
pushlist 'container_graphic_ids' 2476
pushlist 'container_graphic_ids' 2477
pushlist 'container_graphic_ids' 2480
pushlist 'container_graphic_ids' 2481
pushlist 'container_graphic_ids' 2482
pushlist 'container_graphic_ids' 3701
pushlist 'container_graphic_ids' 3702
pushlist 'container_graphic_ids' 3704
pushlist 'container_graphic_ids' 3705
pushlist 'container_graphic_ids' 3712


#Populate Items we care about
removelist 'item_graphic_ids'
createlist 'item_graphic_ids'
pushlist 'item_graphic_ids' 3705 
pushlist 'item_graphic_ids' 3897 
pushlist 'item_graphic_ids' 3985 
pushlist 'item_graphic_ids' 5356 
pushlist 'item_graphic_ids' 5981 
pushlist 'item_graphic_ids' 27611 
pushlist 'item_graphic_ids' 6464 
pushlist 'item_graphic_ids' 3530 
pushlist 'item_graphic_ids' 3836 

while not dead
    clearignore 
    @hotkey 'Next Humanoid Target'
    wait 350
    @setvar! 'lastserial' lasttarget
    getlabel 'lastserial' 'seriallabel'
    if not insysmsg "No one matching that was found"
        if noto 'lastserial' = invulnerable 
            if findtype 3701 'lastserial' as foundBackpack
                dclick 'foundBackpack'
                overhead 'Before Dig'
                #Now we dig
                #List items in top layer
                foreach searchItem in 'item_graphic_ids'
                    #Search through list
                    while findtype searchItem 'foundBackpack' as foundItem
                        #found an item, display it to log
                        @getlabel 'foundItem' foundItemLabel
                        sysmsg foundItemLabel 33
                        @ignore foundItem
                        wait 500
                    endwhile
                endfor
                
                #Start container part
                foreach searchContainer in 'container_graphic_ids'
                    while findtype searchContainer 'foundBackpack' as foundContainer
                        dclick foundContainer
                        wait 600
                        @getlabel 'foundContainer' foundContainerLabel
                        #output container label for bulk sells
                        sysmsg foundContainerLabel 33
                                
                        #container is open, now search it
                        foreach searchItem in 'item_graphic_ids'
                            #Search through list
                            while findtype searchItem 'foundContainer' as foundItem
                                #found an item, display it to log
                                @getlabel 'foundItem' foundItemLabel
                                sysmsg foundItemLabel 33
                                @ignore foundItem
                                wait 500
                            endwhile
                        endfor
                        
                        @ignore foundContainer
                    endwhile
                endfor
                overhead 'After Dig'
            endif
        endif
    endif
    wait 2500
endwhile