if diffhits > 25 
    cast 'Greater Heal'
    waitfortarget 5000
    target 'self'
elseif diffmana > 10 and not findbuff "Actively Meditating"
    skill "Meditation"
    wait 555
elseif findbuff "Actively Meditating" and diffmana > 2
    wait 200
else
    if skill "Magery" < 70
        cast 'Invisibility'
    else
        cast 'Flamestrike'
    endif
    waitfortarget
    target 'self'
endif    
wait 500
if skill "Magery" < 80
    replay
endif