# Clear sys messaages 
clearsysmsg

@setvar onABoat 0

if not timerexists "healpot"
    createtimer "healpot"
    settimer "healpot" 8000
endif
if not timerexists "aid time"
    createtimer "aid time"
    settimer "aid time" 8000
endif
 
if not timerexists "shroomy"
    createtimer "shroomy"
    settimer "shroomy" 61000
endif

while not dead
        
    # If hidden, skip
    if hidden
        continue
    endif
    if findtype '5188' ground -1 -1 2
        dclicktype '5188' ground -1 -1 2
    endif
    
    #spyglass routine
    if diffhits < 25 and not timerexists "spyGlassPeek"
        createtimer 'spyGlassPeek'
        settimer 'spyGlassPeek' 0
    endif
    if diffhits < 25 and not findbuff "Actively Meditating" and not queued and not targetexists and onABoat = 1 and timer "spyGlassPeek" > 6500 and findtype 'spyglass' self 
        gumpclose 2890020940
        wait 100
        gumpclose 2890020940
        dclicktype 5365
        while not targetexists  
            wait 20
        endwhile
        if targetexists 'Neutral'
            target 'self'
            waitforgump 2890020940
            gumpresponse 4 2890020940
            waitforgump 2890020940
            overhead "spyglass"
            sysmsg "spyglass"
            @setvar blueFound 0
            if ingump "a small ship" 2890020940 or  ingump "a small dragon ship" 2890020940 or   ingump "a medium ship" 2890020940 or    ingump "a medium dragon ship" 2890020940 or  ingump "a large ship" 2890020940 or     ingump "a large dragon ship" 2890020940 or   ingump "a carrack" 2890020940 or   ingump "a galleon" 2890020940
                    overhead "Player BOAT" 43
                    wait 250
                    overhead "Player BOAT" 43
                    wait 250
                    overhead "Player BOAT" 43
                    @setvar blueFound 1
            endif
            while ingump "Next" 2890020940 and blueFound = 0
                gumpresponse 3 2890020940
                wait 350
                if ingump "a small ship" 2890020940 or  ingump "a small dragon ship" 2890020940 or   ingump "a medium ship" 2890020940 or    ingump "a medium dragon ship" 2890020940 or  ingump "a large ship" 2890020940 or     ingump "a large dragon" 2890020940 or   ingump "a carrack" 2890020940 or   ingump "a galleon" 2890020940
                    overhead "Player BOAT" 43
                    wait 250
                    overhead "Player BOAT" 43
                    wait 250
                    overhead "Player BOAT" 43
                    @setvar blueFound 1
                endif
            endwhile   
            settimer "spyGlassPeek" 0
        endif
    endif
    
    if insysmsg "You must be onboard"
        @setvar onABoat 0
    endif
    
    if insysmsg 'you cannot move!'
        overhead 'Paralyzed!' 34
        say [pouch
    endif
    
    #Eat a magic mushroom if we have 
    #25  less mana than full
    if diffhits < 25 and  mana < 70 and skill 'Magery' > 50 and timer "shroomy" >= 61000
        dclicktype '29012'
        overhead 'Mushroom Power!'
        settimer "shroomy" 0
    endif

    # Healing Survival
    if skill 'Healing' > 1 
       if hits < maxhits and not bandaging
            hotkey 'Bandage Self'
        endif
    endif

 
    if not findtype 3852 backpack
        overhead 'Out of heal potions!' 34
        wait 200
    endif
    
    //Heal drinker if below 45
    if hp < 45
        if findtype 3852 backpack
            if timer "healpot" >= 9000
                    overhead 'Drinking heal!'
                    potion "heal"
                    wait 200
                    settimer "healpot" 0
            endif
        endif
     endif
    

     
     wait 100
endwhile