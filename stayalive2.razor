# Clear sys messaages 
overhead "Background Scripts Engaged" 44
if not varexist  wildBool
    @setvar! wildBool 0
endif

#set to 1 to auto pot
@setvar! autoPot 1

#set to 1 to auto glass
@setvar! autoGlass 0

#set to 1 to swap to Wild Swing on disarm
@setvar! autoWildSwing 1

#set to 1 to disable disarm on hits
@setvar! autoDisarm 1

if not timerexists  'wildman'
    createtimer 'wildman'
    settimer  'wildman' 20000
endif

if not timerexists  'potion recovery'
    createtimer 'potion recovery'
    settimer  'potion recovery' 20000
endif

if not timerexists 'castspell recovery'
    createtimer 'castspell recovery'
    settimer 'castspell recovery' 20000
endif
if not timerexists 'next free cure'
    createtimer 'next free cure'
    settimer 'next free cure' 60000
endif
if not timerexists "ghealcast"
    createtimer "ghealcast"
    settimer "ghealcast" 8000
endif
if not timerexists "overheadSpam"
    createtimer "overheadSpam"
    settimer "overheadSpam" 8000
endif
if not timerexists "healpot"
    createtimer "healpot"
    settimer "healpot" 8000
endif
if not timerexists "aid time"
    createtimer "aid time"
    settimer "aid time" 8000
endif
 
if not timerexists "shroomy"
    createtimer "shroomy"
    settimer "shroomy" 61000
endif

if not varexist onABoat
    @setvar onABoat 0
endif

while not dead
        
    # If hidden, skip
    if hidden
        continue
    endif
    
    if onABoat = 1 and hits < 25
        say "[embark"
    endif
    
    #turn disarm off automagically
    if autoDisarm = 1
        if insysmsg 'fail to disarm' say "[disarm"
            overhead "Disabling Disarm"
            say '[disarm'
        endif
    endif
    
    #swap stances to get most out of single target disarm
    if autoWildSwing = 1
        #go back to Sunder if we are in Wild
        if timer 'wildman' > 10500 and wildBool = 1
            overhead "SUNDER THE EARTH" 44
            yell '[macingstance5'
            settimer 'wildman' 0
            @setvar! wildBool 0
        endif       

        if insysmsg 'disarms your target'
            overhead "GOIN WILD" 44
            yell '[macingstance4'
            settimer 'wildman' 0
            @setvar! wildBool 1
            wait 250
            say "[disarm"
            overhead "Disabling Disarm"
        endif
    endif
    
    #yell about bombs
      if timer "overheadSpam" >= 500 and findtype '5188' ground -1 -1 8
          overhead "Bomb down!!!" 33
          settimer "overheadSpam" 0
      endif    
    
    if insysmsg 'you cannot move!'
        overhead 'Paralyzed!' 34
        say [pouch
    endif

    # Healing Survival
    if skill 'Healing' > 1 
       if hits < maxhits and not bandaging
            hotkey 'Bandage Self'
        endif
    endif

 
    if not findtype 3852 backpack
        overhead 'Out of heal potions!' 34 
        wait 500
    endif
    

    if skill 'Magery' > 50 and diffhits > 22 and timer 'overheadSpam' >= 750
        overhead "HEALING TIME" 77
        sysmsg   "HEALING TIME" 77
        overhead "HEALING TIME" 33
        sysmsg   "HEALING TIME" 33
        overhead "HEALING TIME" 22
        sysmsg   "HEALING TIME" 22
        settimer 'overheadSpam' 0
    endif
    
    
    # Monitor for free cure pot
    if insysmsg 'receive a free cure potion'
        settimer 'next free cure' 0
    endif

    # Cure Survival
    if skill 'Chivalry' < 70 and not targetexists any
        if poisoned 'self' and timer 'next free cure' >= 30000 and timer 'potion recovery' > 1000
            if findtype 3847 'backpack'
                overhead '[Used: Cure Pot]' 68
                hotkey 'Drink Cure'
                # Set timer for free cure
                if insysmsg 'receive a free cure potion'
                    settimer 'next free cure' 0
                endif
                settimer 'potion recovery' 0
            endif
        endif
    endif
    
         
    # Heal Potion
    if not timerexists 'healpot recovery'
        createtimer 'healpot recovery'
        settimer 'healpot recovery' 20000
    endif
    
    #Auto Pot 
    if autoPot = 1
        if diffhits < 15 and timer 'healpot recovery' >= 1500 and skill "Alchemy" >= 20 and  findbuff 'Agility' < 10
            wait 510
            potion 'agility'
            settimer 'healpot recovery' 0
        endif
        if  diffhits < 15 and timer 'healpot recovery' >= 1500 and skill "Alchemy" >= 20 and  findbuff 'magic resist potion'  < 10
            wait 510
            potion 'nightsight'
            settimer 'healpot recovery' 0
        endif    
        if diffhits < 15 and timer 'healpot recovery' >= 1500 and skill "Alchemy" >= 20 and  findbuff 'Strength' < 10
            wait 510
            potion 'strength'
            settimer 'healpot recovery' 0
        endif
    endif
    
    if hits < 40
        if timer 'healpot recovery' >= 10500 and timer 'potion recovery' > 1000
            if findtype 3852 'backpack'
                overhead '[Used: GHeal Pot]' 68
                hotkey 'Drink Heal'
                settimer 'healpot recovery' 0
                settimer 'potion recovery' 0
            endif
        elseif skill 'Magery' > 50
            overhead "HEAL DAMMIT HEAL"
            hotkey "Play Script: greaterhealself"
        endif
    endif
    
    #automatically spyglass 
    if not timerexists "spyGlassPeek"
        createtimer "spyGlassPeek"
        settimer "spyGlassPeek" 7000
    endif    
    if timer "spyGlassPeek" > 6100 and not targetexists and autoGlass = 1       
        hotkey "Play Script: Spyglass Boat"
    endif
    
endwhile